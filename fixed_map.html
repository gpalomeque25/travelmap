async function loadData() {
    try {
        const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQVaW9Ob_dKfnVAbCZ-I3PDKlInuK52WNU72v4AAmyZhVI50mZbgqy7ay561odtImwmG-92_F_S-KUX/pub?output=csv');
        const csvText = await response.text();

        console.log("CSV Response:", csvText); // Debugging

        Papa.parse(csvText, {
            header: true,
            skipEmptyLines: true,
            complete: function(result) {
                console.log("Parsed Data:", result.data); // Debugging

                if (result.data.length === 0) {
                    console.error("CSV is empty or not formatted correctly.");
                    return;
                }

                console.log("Column Names:", Object.keys(result.data[0])); // Debugging column names
                
                markers.clearLayers();

                result.data.forEach(row => {
                    // Match column names exactly as they appear in Google Sheets
                    const name = row["Resort/Hotel/Airbnb name"]?.trim();
                    const location = row["Location"]?.trim();
                    const lat = parseFloat(row["Latitude"]?.trim());
                    const lng = parseFloat(row["Longitude"]?.trim());

                    console.log("Adding Marker:", name, lat, lng); // Debugging

                    if (name && location && !isNaN(lat) && !isNaN(lng)) {
                        const marker = L.marker([lat, lng]).bindPopup(`<b>${name}</b><br>${location}`);
                        markers.addLayer(marker);
                    }
                });

                map.addLayer(markers);
                if (markers.getLayers().length > 0) {
                    map.fitBounds(markers.getBounds(), { padding: [50, 50] });
                }
            }
        });
    } catch (error) {
        console.error('Error loading data:', error);
    }
}
